#include "task.h"
#include "main.h"
#include "cmsis_os.h"
#include <stdio.h>

extern void sendData(uint32_t cnt);

// Task 핸들 및 속성 정의
osThreadId_t defaultTaskHandle;
const osThreadAttr_t defaultTask_attributes = {
  .name = "defaultTask",
  .stack_size = 128 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t HC12SendTaskHandle;
const osThreadAttr_t HC12SendTask_attributes = {
  .name = "HC12SendTask",
  .stack_size = 128 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

// Task 함수 선언
void StartDefaultTask(void *argument);
void StartHC12SendTask(void *argument);

// Task 생성 함수
void systemInit(void)
{
  defaultTaskHandle = osThreadNew(StartDefaultTask, NULL, &defaultTask_attributes);
  HC12SendTaskHandle = osThreadNew(StartHC12SendTask, NULL, &HC12SendTask_attributes);
}

// Task 실행 함수들
void StartDefaultTask(void *argument)
{
  for(;;)
  {
    osDelay(1);
  }
}

void StartHC12SendTask(void *argument)
{
  uint32_t count = 0;
  for(;;)
  {
    sendData(count);  // 외부 선언 필요
    count++;
    osDelay(1000);
  }
}
