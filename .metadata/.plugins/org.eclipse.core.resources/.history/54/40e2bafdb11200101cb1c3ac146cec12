#include <stdio.h>
#include <string.h>
#include "FreeRTOS.h"
#include "task.h"
#include "queue.h"
#include "main.h"

/* The task functions. */
void StartHC12SendTask( void *argument );

extern UART_HandleTypeDef huart7;
extern UART_HandleTypeDef husart3;

TaskHandle_t hc12SendTaskHandle;

void systemTaskInit(void)
{
  xTaskCreate(StartHC12SendTask, "HC12SendTask", 128, NULL, tskIDLE_PRIORITY + 1, &hc12SendTaskHandle);
}

void sendData(int cnt)
{
	char txBuffer[20];
	sprintf(txBuffer, "%d\r\n", cnt);
	HAL_UART_Transmit(&huart7, (uint8_t*)txBuffer, strlen(txBuffer), HAL_MAX_DELAY);
}

// HC-12 Send Task
void StartHC12SendTask(void *argument)
{
  uint32_t count = 0;
  for (;;)
  {
    sendData(count++);
    vTaskDelay(pdMS_TO_TICKS(1000));
  }
}
