#include <stdio.h>
#include <string.h>
#include "FreeRTOS.h"
#include "task.h"
#include "queue.h"

/* The task functions. */
void TaskMain( void *pvParameters );
void StartHC12SendTask( void *argument );


// Task 핸들 정의
TaskHandle_t defaultTaskHandle;
TaskHandle_t hc12SendTaskHandle;

void sendData(uint32_t cnt)
{
  char txBuffer[32];
  sprintf(txBuffer, "Count: %lu\r\n", cnt);
  HAL_UART_Transmit(&huart3, (uint8_t*)txBuffer, strlen(txBuffer), HAL_MAX_DELAY);
}


// Task 속성 정의
const osThreadAttr_t HC12SendTask_attributes = {
  .name = "HC12SendTask",
  .stack_size = 128 * 4,
  .priority = osPriorityNormal,
};


// HC-12 Send Task
void StartHC12SendTask(void *argument)
{
  uint32_t count = 0;
  for (;;)
  {
    sendData(count++);
    vTaskDelay(pdMS_TO_TICKS(1000));
  }
}


// ⭐ Task 생성 함수
void SystemTaskInit(void)
{
  xTaskCreate(StartDefaultTask, "DefaultTask", 128, NULL, tskIDLE_PRIORITY + 1, &defaultTaskHandle);
  xTaskCreate(StartHC12SendTask, "HC12SendTask", 128, NULL, tskIDLE_PRIORITY + 1, &hc12SendTaskHandle);
}
